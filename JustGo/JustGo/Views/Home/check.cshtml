@{
    ViewData["Title"] = "check";
}

@section Style{
<!-- <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" asp-append-version="true" /> -->
<link rel="stylesheet" href="~/css/main.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

<style>
    header {
        display: none;
    }

    .footer__waves {
        display: none;
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.min.css" />
}

<div id="app">
    <div>

        <div>
            <div v-for="day in schedule.details">
                <div v-for="view in day">
                    {{view.place.name}}
                </div>
            </div>
        </div>

    </div>
    <div>
        <div v-for="(day,index) in schedule.details" @@click="showDaySchedule(index)" type="button">{{index+1}}</div>
        <div id="map"></div>
        <div v-for="view in daySchedule">{{view.place.name}}</div>
        <button @@click="showLat">giveMeLat</button>
    </div>
</div>



@section Scripts{
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtVnIXm-IWFLMzIL_XlbCjLyQjSuEVVhk"></script>
<script src="https://unpkg.com/axios/dist/axios.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

<script>
    new Vue({
        el: '#app',
        data() {
            return {
                schedule: [],
                daySchedule: [],
                map: null,
                icon: {
                    url: "@Url.Content("~/file/photo/location_Yuju.png")",
                    scaledSize: new google.maps.Size(50, 50),
                    labelOrigin: new google.maps.Point(25, 17)
                },
            }
        },
        methods: {
            initMap() {
                this.map = new google.maps.Map(document.getElementById("map"), {
                    center: { lat: 23.573837, lng: 120.97969 },
                    zoom: 8,  // 0-20
                    mapId: '1d3a304bcea5789e',
                    mapTypeControl: false,  // 換地圖類型
                    streetViewControl: false,  // 街道檢視
                    fullscreenControl: false, // 全螢幕顯示
                    clickableIcons: false,   // 可不可以點地圖上的點
                });
            },
            showDaySchedule(index) {

                this.daySchedule = this.schedule.details[index]
                console.log(this.daySchedule)
            },
            showLat() {// 輔助用
                console.log(this.schedule.details[0])
                console.log(this.schedule.details[0][0])
                console.log(this.schedule.details[0][0].place)
                console.log(this.schedule.details[0][0].place.lat)
            },
            setMarker() {
                const markers = [];
                const bounds = new google.maps.LatLngBounds();
                let iofSpots = 0
                for (i = 0; i < this.schedule.details.length; i++) {
                    this.schedule.details[i].map((position, j) => {
                        iofSpots++
                        const marker = new google.maps.Marker({
                            position: { lat: position.place.lat, lng: position.place.lng },
                            label: {
                                text: `${iofSpots}`,
                                fontWeight: "bold",
                            },
                            title: position.place.name,
                            map: this.map,
                            icon: this.icon,
                        });
                        bounds.extend(marker.position);
                        // 產生infowindow
                        let contentString =
                            `
                            <div class="infowindow">
                                <div class="infowindow_bar row row-cols-2" >
                                    <div class="infowindow_bar_title col-10">
                                        ${position.place.name}
                                    </div>
                                    <div class="infowindow_bar_divbutton col-2">
                                        <div class="infowindow_bar_button" type="button" onclick="addView()">

                                        </div>
                                    </div>
                                </div>
                                <div class="infowindow_part row">
                                    <div class="infowindow_img col-4">
                                        <img src="https://www.taiwan.net.tw/pic.ashx?qp=1/big_scenic_spots/pic_11548_18.jpg&sizetype=3" class="infowindow_picture">
                                    </div>
                                    <div class="infowindow_info col-8">
                                        <p><i class="fa-solid fa-house-crack" style="color:#1C0059"></i> ${position.place.add}</p>                                     
                                        <p><i class="fa-solid fa-phone" style="color:#260078"></i> ${position.place.tel}</p>
                                        <p><i class="fa-solid fa-clock" style="color:#3500A8"></i> ${position.place.opentime}-${position.place.closetime}</p>
                                    </div>
                                </div>
                                <button class="infowindow_intro" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample"
                                    aria-expanded="false" aria-controls="collapseExample">
                                    景點介紹
                                </button>
                                <div class="collapse" id="collapseExample">
                                    <div class="infowindow_detail" style="text-indent:2em">
                                        ${position.place.description}
                                    </div>
                                </div>
                            </div>
                            `
                        const infowindow = new google.maps.InfoWindow({
                            content: contentString,
                            disableAutoPan: false,
                        });
                        // 點擊marker開啟infowindow
                        marker.addListener("click", () => {
                            if (this.infowindow) { this.infowindow.close() }
                            infowindow.open({
                                anchor: marker,
                                map: this.map,
                                shouldFocus: false,
                            });
                            this.infowindow = infowindow
                        });
                        markers.push(marker);
                    });
                }
                this.map.fitBounds(bounds);
            },
        },
        computed: {

        },
        mounted() {
            //let id = window.location.search.substring(1)
            //if (id != "") {
            axios.post("@Url.Action("selectDetail","Schedule")", { ScheduleId: 113 })
                .then(res => this.schedule = res.data).then(() => this.initMap()).then(() => this.setMarker())
                .catch(err => console.log(err))
            //}
            //this.initMap()
            //this.setMarker()
        },
    })
</script>
}