@*@{
    ViewData["Title"] = "Just Go - 旅遊規劃網站";
}*@

@section Style{
    <!-- <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" asp-append-version="true" />  -->
    <link rel="stylesheet" href="~/css/main.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />



}

    @section Scripts{
    <!-- jQuery is loaded in _Layout.cshtml -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            onerror="console.error('Failed to load Bootstrap');"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"
            onerror="console.error('Failed to load Typed.js'); window.Typed = function(){};"></script>
    <script src="~/js/site.js"></script>
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js" onerror="console.error('Failed to load Vue from unpkg'); this.onerror=null; this.src='https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js';"></script>
    <script src="https://unpkg.com/axios@1.5.0/dist/axios.min.js"
            onerror="console.error('Failed to load Axios'); alert('無法載入必要資源，請檢查網路連線並重新整理頁面');"></script>



    <script>
        var typed = new Typed(".auto-type", {
            strings: ["還在為排行程煩惱嗎?", "旅行也可以很簡單"], typeSpeed: 100, backSpeed: 100, loop: false
        });
        var navbar = document.getElementById("navbarC");
        var menu = document.getElementById("navbarC__menu");
    </script>
    <script>
        // Check if Vue is loaded
        if (typeof Vue === 'undefined') {
            console.error('Vue is not loaded! Check your internet connection or CDN availability.');
            alert('Vue.js failed to load. Please refresh the page or check your internet connection.');
        }
        const {reactive, ref ,onMounted} = Vue;
          const App = {
              setup() {
                  const search = reactive({ results: [] })
                  let searchString = ref("")
                  const top4Blog = reactive({ results: [] })
                  const isLoadingBlogs = ref(false)
                  const isLoadingTop4 = ref(true)
                  const northern = ['基隆市', '新北市', '臺北市', '桃園市', '新竹縣', '新竹市', '宜蘭縣'];
                  const central = ['苗栗縣', '臺中市', '彰化縣', '南投縣', '雲林縣',];
                  const south = ['嘉義縣', '嘉義市', '臺南市', '高雄市', '屏東縣',];
                  const east = ['花蓮縣', '臺東縣', '澎湖縣', '連江縣', '金門縣'];
                  let searchNumber = 12;
                  const select = reactive({ selectCounty: [], selectAcitivity: [], searchNumber: 0, Search: "" })
                  let active = ref('');                  
                  function light(area){
                         active.value = area
                  }
                  function searchBlog(area) {
                     
                      light(area)
                      select.searchNumber = 0;
                      switch (area) {
                          case "北部":
                              if (select.selectCounty[0] != northern[0]) {
                                  select.selectCounty = northern;
                                  select.Search = "";
                                 

                              }
                              else {
                                  select.selectCounty = []
                                  select.Search = "";
                              }
                              break;
                          case "中部":
                              if (select.selectCounty[0] != central[0]) {
                                  select.selectCounty = central;
                                  select.Search = "";
                              } else {
                                  select.selectCounty = []
                                  select.Search = "";
                              }
                              break;
                          case "南部":
                              if (select.selectCounty[0] != south[0]) {
                                  select.selectCounty = south;
                                  select.Search = "";
                              } else {
                                  select.selectCounty = []
                                  select.Search = "";
                              }
                              break;
                          case "東部":
                              if (select.selectCounty[0] != east[0]) {
                                  select.selectCounty = east;
                                  select.Search = "";
                              } else {
                                  select.selectCounty = []
                                  select.Search = "";
                              }
                              break;
                          case "搜尋":
                              select.Search = searchString.value;
                              searchString.value = "";
                              break;
                          default:
                              select.selectCounty = [];
                              select.Search = "";
                              break;
                      }
                      isLoadingBlogs.value = true;
                      axios.post("@Url.Action("searchBlog","Blog")", select)
                          .then(res => {
                              search.results = res.data;
                              isLoadingBlogs.value = false;
                          })
                          .catch(err => {
                              console.error('Failed to search blogs:', err);
                              isLoadingBlogs.value = false;
                          });
                  }
                  function imageSrc(imageName) {
                      return "@Url.Content("~/blogImages")/" + imageName
                  }
                  function userImageSrc(userImage) {
                      return "@Url.Content("~/userImages")/" + userImage
                  }
                  function open(e) {
                    active.value = ''
                      $("#sh").toggleClass("sh")
                      if ($('#sh')[0].clientWidth >= $('#findw')[0].clientWidth * 1.1) {
                          $('#shbox').addClass('tgshow')
                          $('#shbtn').addClass('tgshow')
                      } else {
                          $('#shbox').removeClass('tgshow')
                          $('#shbtn').removeClass('tgshow')
                          $('#shbox')[0].focus()
                      }
                  }
                  function blogUrl(id) {
                      return "@Url.Action("Blog","Home")?" + id
                  }
                  // Throttle flag to prevent multiple simultaneous requests
                  let isLoadingMore = false;

                  function scroll() {
                      // Throttle: prevent multiple simultaneous requests
                      if (isLoadingMore) return;

                      if (window.scrollY + window.screen.height >= document.body.scrollHeight - 100) {
                          isLoadingMore = true;
                          select.searchNumber += searchNumber;
                          axios.post("@Url.Action("searchBlog","Blog")", select)
                              .then(res => {
                                  Array.prototype.push.apply(search.results, res.data);
                                  isLoadingMore = false;
                              })
                              .catch(err => {
                                  console.error('Failed to load more blogs:', err);
                                  isLoadingMore = false;
                              });
                      }
                  }
                  function TAG(tag){
                        switch (tag) {
                            case 1:
                                return '文化';
                                break;
                            case 2:
                                return '生態'                      
                                break;
                            case 3:
                                return '古蹟'
                                break;                       
                            case 4:
                                return '廟宇'
                                break;
                            case 5:
                                return'藝術'                      
                                break;
                            case 6:
                                return '小吃特產'
                                break;                     
                            case 7:
                                return '國家公園'
                                break;
                            case 8:
                                return '國家風景區'                      
                                break;
                            case 9:
                                return '休閒農業'
                                break;
                            case 10:
                                return '溫泉'
                                break;
                            case 11:
                                return '自然風景'                      
                                break;
                            case 12:
                                return'遊憩'
                                break;
                            case 13:
                                return '體育健身'
                                break;
                            default:
                                return '其他'                      
                                break;                   
                    }
                  }
                 
                  function po() {
                      // Guard against unloaded data
                      if (!top4Blog.results || top4Blog.results.length < 4) {
                          console.warn('Top 4 blogs not loaded yet');
                          return;
                      }

                      var mouse = {
                          X: 0,
                          Y: 0,
                          CX: 0,
                          CY: 0
                      },
                          block = {
                              X: mouse.X,
                              Y: mouse.Y,
                              CX: mouse.CX,
                              CY: mouse.CY
                          },
                          imags = [
                              imageSrc(top4Blog.results[0].coverImage.name),
                              imageSrc(top4Blog.results[1].coverImage.name),
                              imageSrc(top4Blog.results[2].coverImage.name),
                              imageSrc(top4Blog.results[3].coverImage.name)
                          ];

                      $('.block').on('mousemove', function(e) {
                          mouse.X = (e.pageX - $(this).offset().left) - $('.block').width() / 2;
                          mouse.Y = (e.pageY - $(this).offset().top) - $('.block').height() / 2;
                      })

                      $('.block').on('mouseleave', function(e) {
                          mouse.X = mouse.CX;
                          mouse.Y = mouse.CY;
                      })

                      setInterval(function() {

                          block.CY += (mouse.Y - block.CY) / 12;
                          block.CX += (mouse.X - block.CX) / 12;

                          $('.block .circleLight').css('background', 'radial-gradient(circle at ' + mouse.X + 'px ' + mouse.Y + 'px, #fff, transparent)')
                          $('.block').css({
                              transform: 'scale(1.03) translate(' + (block.CX * 0.05) + 'px, ' + (block.CY * 0.05) + 'px) rotateX(' + (block.CY * 0.05) + 'deg) rotateY(' + (block.CX * 0.05) + 'deg)'
                          })

                      }, 20);

                      $('.slider .item').each(function(i) {

                          if (i == 0) {

                              $(this).addClass('active');
                              $(this).next().addClass('next');
                              $(this).prev().addClass('prev');
                          }

                          $(this).attr('id', 'slide-' + i);

                          $(this).prepend(
                              
                              $('<div>', { class: 'blur', style: 'background-image: url(' + imags[i] + ');' }),
                             
                              $('<div>', { class: 'bg', style: 'background-image: url(' + imags[i] + ');' })
                          )

                          $(this).find('.block').css('background-image', 'url(' + imags[i] + ')')


                          $('.navigations .dots').append(
                              $('<li>', { class: i == 0 ? 'active' : '', id: i }).on('click', function() {
                                  var cSlide = $('.slider #slide-' + $(this).attr('id'));

                                  $('.navigations .dots li').removeClass('active');
                                  $(this).addClass('active');

                                  $('.slider .item').removeClass('active prev next');
                                  cSlide.addClass('active');
                                  cSlide.next().addClass('next');
                                  cSlide.prev().addClass('prev');
                              })
                          )
                      })
                  }
                  onMounted(() => {
                      window.addEventListener('scroll', scroll);
                      searchBlog("");

                      // Load top 4 blogs and initialize slider after data is loaded
                      axios.get("@Url.Action("getBlogTop4","blog")")
                          .then(res => {
                              top4Blog.results = res.data;
                              isLoadingTop4.value = false;
                              // Initialize slider after data is loaded
                              po();
                          })
                          .catch(err => {
                              console.error('Failed to load top 4 blogs:', err);
                              isLoadingTop4.value = false;
                          });
                  })
                  return {
                      search, northern, central, south, east, searchNumber,top4Blog,active,TAG,
                      select, searchString, searchBlog, imageSrc, userImageSrc, open, blogUrl,
                      isLoadingBlogs, isLoadingTop4
                  }
              },
        }
        Vue.createApp(App).mount("#app")
    </script>


}


    <div class="idx__contaim">
        <div class="index">
            <video autoplay muted loop plays-inline class="index__bg-video" poster="~/file/photo/beach.jpg">
                <source src="~/file/video/beach.mp4" type="video/mp4">
            </video>
        </div>
        <p class="text-center typer"><span class="auto-type"></span></p>
        <div class="index__home-bt">
            <a asp-area="" asp-controller="Home" asp-action="itinerary">開始規劃</a>
        </div>
    </div>


    <div class="idx__title">
        <div class="idx__title-content">
            <h3>來一場說走就走的旅行</h3>
            <p>Go for a trip</p>
            <div class="idx__title-bt1"></div>
        </div>
    </div>
    @*<a :href="blogUrl(top4Blog.results[0].blogId)">*@
    <div id="app">
    <!-- Loading state for slider -->
    <div v-if="isLoadingTop4" style="text-align: center; padding: 100px;">
        <div style="font-size: 24px; color: #666;">載入熱門遊記中...</div>
    </div>
    <div v-else class="slider">
        <div class="items-group">
            <div class="item">
                <a class="photolink" :href="blogUrl(top4Blog.results[0].blogId)">
                <div class="block">                   
                    <span class="circleLight"></span>
                    <div class="text">
                        <h2 >{{top4Blog.results[0].title}}</h2>                     
                        <p>{{top4Blog.results[0].userame}}</p>
                        
                    </div>
                </div>
                </a>
            </div>
            <div class="item">
                <a class="photolink" :href="blogUrl(top4Blog.results[1].blogId)">
                <div class="block">
                    <span class="circleLight"></span>
                    <div class="text">
                        <h2>{{top4Blog.results[1].title}}</h2>
                        <p>{{top4Blog.results[1].userame}}</p>
                    </div>
                </div>
                </a>
            </div>
            <div class="item">
                <a class="photolink" :href="blogUrl(top4Blog.results[2].blogId)">
                <div class="block">
                    <span class="circleLight"></span>
                    <div class="text">
                        <h2>{{top4Blog.results[2].title}}</h2>
                        <p>{{top4Blog.results[2].userame}}</p>
                    </div>
                </div>
                </a>
            </div>
            <div class="item">
                <a class="photolink" :href="blogUrl(top4Blog.results[3].blogId)">
                <div class="block">
                    <span class="circleLight"></span>
                    <div class="text">
                        <h2>{{top4Blog.results[3].title}}</h2>
                        <p>{{top4Blog.results[3].userame}}</p>
                    </div>
                </div>
                </a>
            </div>
        </div>

            <div class="navigations">
                <ul class="dots"></ul>
            </div>
        </div>


        <div class="idx__title-2" id="recommend">
            <div class="idx__title-2-content">
                <h3>Just go幫你規劃行程</h3>
                <p>紀錄你的旅行回憶</p>
                <div class="idx__title-2-bt"></div>
            </div>
        </div>

        <div class="screnbox">
            <div @@click="searchBlog('北部')"  :class="{ light: active === '北部' }">北部</div>
            <div @@click="searchBlog('中部')" :class="{ light: active === '中部'}">中部</div>
            <div @@click="searchBlog('南部')" :class="{ light: active === '南部'}">南部</div>
            <div id="findw" @@click="searchBlog('東部')" :class="{ light: active === '東部' }">東部</div>
            <div @@click="open($event)" id="sh" class="">
                <i class="fa-solid fa-magnifying-glass"></i>關鍵字
                <input id="shbox" class="tgshow" type="text" placeholder="請輸入關鍵字" v-model="searchString" />
                <button @@click="searchBlog('搜尋')" id="shbtn" class="tgshow"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
        </div>
        <div class="wrapper">
            <!-- Loading state -->
            <div v-if="isLoadingBlogs" style="text-align: center; padding: 40px; width: 100%;">
                <div style="font-size: 24px; color: #666;">載入中...</div>
            </div>
            <!-- Blog cards -->
            <div v-for="(item) in search.results" class="card">
                @*{{item}}*@
                @*<img src="https://unsplash.it/1800/1600/?random/person" alt="">*@
                <img :src="imageSrc(item.coverImage.name)" alt="">
                <div class="info">
                    <div><h2 >{{item.title}}</h2></div>
                    <div style="display: flex;align-items: center;">
                        <img class="usimg" :src="userImageSrc(item.userImage)" alt="">
                        <p style="display: contents">{{item.userName}}</p>
                    </div>
                    <div>
                        <div class="tag">
                            <div v-for="(item,index) in item.tagList">
                            <p v-if="index <3 ">{{TAG(item)}}</p>
                            </div>
                        </div>                     
                    </div>
                    <div>
                        <a :href="blogUrl(item.blogId)" class="btn">read me</a>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
      <partial name="_messagePartial"/> 




